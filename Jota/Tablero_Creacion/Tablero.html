<!doctype html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="Tablero.css">
    <link rel="shortcut icon" href="../Imagenes/favicon.ico">

    <title>Jota | TABLERO DE CREACIÓN</title>
  </head>
  <body>
    <div class="container-fluid" id="Principal">
        <nav class="navbar navbar-expand-lg navbar-light" id="Nav">
            <a class="navbar-brand" href="Tablero.html" id="MargenLogo">
                <img src="../Imagenes/Logo.png" alt="Logo" id="Logo">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#Navegacion" aria-controls="Navegacion" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="Navegacion">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="../Tablero_Creacion/Tablero.html">
                            <img src="../Imagenes/tablero.png" alt="Logo" class="icononav">
                            <b>TABLERO</b>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../Contenedores/Contenedores.html">
                                <img src="../Imagenes/contenedores.png" alt="Logo" class="icononav">
                            <b>CONTENEDORES</b>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../Redes/Redes.html">
                            <img src="../Imagenes/red.png" alt="Logo" class="icononav">
                            <b>REDES</b>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../Volumenes/Volumenes.html">
                            <img src="../Imagenes/volumenes.png" alt="Logo" class="icononav">
                            <b>VOLÚMENES</b>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../ISOS/ISOS.html">
                            <img src="../Imagenes/iso.png" alt="Logo" class="icononav">
                            <b>IMÁGENES</b>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="row col-md-12" id="Contenido">
            <div id="tablerocontenedores" class="col-md-6">

                <div class="card text-center" id="ContenedorNuevo">
                    <div class="card-header" id="headercontenedor">
                        <input id="nombrecontseleccionado" class="inputcontenedor" type="text" placeholder="Nombre del contenedor...">
                        <button type="button" class="close" aria-label="Close">
                            <span aria-hidden="true" id="vaciardatos">&times;</span>
                        </button>
                    </div>
                    <div class="card-body" id="AddElementos">
                        <p id="descripcuerpo">Añadir aquí los elementos del contenedor docker +</p>
                        <div id="pintarred">

                        </div>
                        <div id="pintarvol">

                        </div>
                        <div id="pintariso">

                        </div>
                        <hr>
                        <p id="puertoscontenedor">
                            <b><img src="../Imagenes/llama.png" class="iconocontenedor">PUERTOS:</b>
                            <input id="puertounocontenedorseleccionado" class="puerto" type="text" placeholder=" 23"><sub> ♦ CONTENEDOR</sub>  | 
                            <input id="puertodoscontenedorseleccionado" class="puerto" type="text" placeholder=" 80"><sub> ♦ LOCAL</sub>
                        </p>
                    </div>
                    <div class="card-footer">
                        <a href="#" class="btn btn-success" id="crearcont">Crear Contenedor</a>
                    </div>
                </div><br>

            </div>
            <div id="menudragdrop" class="col-md-6">

                    <div id="acordeon">

                        <div class="card">
                            <div class="card-header" id="HeadRedes">
                                <h5 class="mb-0 tituloheader">
                                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        REDES
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseOne" class="collapse show" aria-labelledby="HeadRedes" data-parent="#acordeon">
                                <div class="card-body" id="tableroredes">
                                    <!--<button id="draggable" type="button" class="btn btn-md red" data-trigger="focus" data-toggle="popover" title="Red de Prueba" data-content="Descripción & Atributos de la red.">Red de Prueba</button>
                                    <button type="button" class="btn btn-md red" data-trigger="focus" data-toggle="popover" title="Otra Red" data-content="Descripción & Atributos de la red.">Otra Red</button>
                                    <button type="button" class="btn btn-md red" data-trigger="focus" data-toggle="popover" title="Host" data-content="Descripción & Atributos de la red.">Host</button>
                                    <button type="button" class="btn btn-md red" data-trigger="focus" data-toggle="popover" title="None" data-content="Descripción & Atributos de la red.">None</button>
                                    <button type="button" class="btn btn-md red" data-trigger="focus" data-toggle="popover" title="Bridge" data-content="Descripción & Atributos de la red.">Bridge</button>
                                    <p><a href="../Redes/Redes.html" class="linkadd"><img src="../Imagenes/mas.png" class="iconoadd"> Añadir Redes...</a></p>-->
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header" id="HeadVolumenes">
                                <h5 class="mb-0 tituloheader">
                                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        VOLÚMENES
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseTwo" class="collapse" aria-labelledby="HeadVolumenes" data-parent="#acordeon">
                                <div class="card-body" id="tablerovolumenes">
                                    <!--<button type="button" class="btn btn-md vol" data-trigger="focus" data-toggle="popover" title="Volúmen Nuevo" data-content="Descripción & Atributos del volumen.">Volúmen Nuevo</button>
                                    <button type="button" class="btn btn-md vol" data-trigger="focus" data-toggle="popover" title="Volúmen de Prueba" data-content="Descripción & Atributos del volumen.">Volúmen de Prueba</button>
                                    <button type="button" class="btn btn-md vol" data-trigger="focus" data-toggle="popover" title="Carpeta Compartia" data-content="Descripción & Atributos del volumen.">Carpeta Compartida</button>
                                    <button type="button" class="btn btn-md vol" data-trigger="focus" data-toggle="popover" title="Almacenamiento" data-content="Descripción & Atributos del volumen.">Almacenamiento</button>
                                    <button type="button" class="btn btn-md vol" data-trigger="focus" data-toggle="popover" title="Host" data-content="Descripción & Atributos del volumen.">Host</button>                                    
                                    <p><a href="../Volumenes/Volumenes.html" class="linkadd"><img src="../Imagenes/mas.png" class="iconoadd"> Añadir Volúmenes...</a></p>-->
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header" id="HeadImagenes">
                                <h5 class="mb-0 tituloheader">
                                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        IMÁGENES
                                    </button>
                                </h5>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="HeadImagenes" data-parent="#acordeon">
                                <div class="card-body" id="tableroisos">
                                    
                                </div>
                            </div>
                        </div>

                    </div>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            $('[data-toggle="popover"]').popover()
        })

        // VACIAR DATOS DEL CONTENEDOR //

        $("#vaciardatos").click(function(){
            $("#descripcuerpo").html("Añadir aquí los elementos del contenedor docker +");
            $("#pintarred").html("");
            $("#pintariso").html("");
            $("#pintarvol").html("");
            $("#puertounocontenedorseleccionado").val("");
            $("#puertodoscontenedorseleccionado").val("");
            $(".inputcontenedor").val("");
            $("#descripcioncontenedor").val("");
            console.log("vasiaoh");
        });

    </script>

<script>



        // CREAR CONTENEDOR ------------------------------------------------- >> - << //
        

        // Coger la ISO seleccionada.
        $(document).on("click",".isospc", function(){

            var nombreiso = $(this).attr("value");
            console.log("click >> "+nombreiso);

            $("#descripcuerpo").html("<p>▼ Abajo se añadirán los nuevos detalles del contenedor ▼<hr></p>");
            $("#pintariso").html("");
            $("#pintariso").append("<br><span class='isoseleccionada' data='"+nombreiso+"'><img src='../Imagenes/llama.png' class='iconocontenedor' /><b>ISO:</b> "+nombreiso+"</span>");

        });

        // Coger la Red seleccionada.
        $(document).on("click",".redespc", function(){

                var nombrered = $(this).attr("value");
                console.log("click >> "+nombrered);

                $("#pintarred").html("");
                $("#descripcuerpo").html("<p>▼ Abajo se añadirán los nuevos detalles del contenedor ▼<hr></p>");
                $("#pintarred").append("<br><span class='redseleccionada' data='"+nombrered+"'><img src='../Imagenes/llama.png' class='iconocontenedor' /><b>RED:</b> "+nombrered+"</span><br>");

        });

        // Coger el volumen seleccionado.
        $(document).on("click",".volpc", function(){

                var nombrevol = $(this).attr("value");
                console.log("click >> "+nombrevol);

                $("#pintarvol").html("");
                $("#descripcuerpo").html("<p>▼ Abajo se añadirán los nuevos detalles del contenedor ▼<hr></p>");
                $("#pintarvol").append("<br><span class='volseleccionado'><img src='../Imagenes/llama.png' class='iconocontenedor' /><b>VOLUMEN:</b> "+nombrevol+"</span><br>");

        });



        // CREAR EL CONTENEDOR AL DARLE AL BOTÓN.
        $(document).on("click","#crearcont", function(){


            /* if(($("#nombrecontseleccionado").val() !== "") && ($("#puertounocontenedorseleccionado").val() !== "") && ($("#puertodoscontenedorseleccionado").val() !== "") ){*/

                var Nombre = $("#nombrecontseleccionado").val();
                console.log(Nombre);

                var ISO = $(".isoseleccionada").attr("data");
                console.log(ISO);

                var Red = $(".redseleccionada").attr("data");
                console.log(Red);

                var PuertoContenedor = $("#puertounocontenedorseleccionado").val();
                console.log("LOCAL"+PuertoContenedor);

                var PuertoLocal = $("#puertodoscontenedorseleccionado").val();
                console.log("LOCAL"+PuertoLocal);

                $(function() {

                    $.ajax({                           
                    method:  "POST",
                        dataType: 'json',
                        contentType: "application/json",   
                        url: "http://localhost:2376/containers/create?name="+Nombre+"", 
                        data: JSON.stringify(
                        { "name" : Nombre,
                          "Image": ISO,
                          "HostConfig": {
                            "PortBindings": {
                                [PuertoContenedor] : [
                                    {
                                    "HostIp" : "0.0.0.0",
                                    "HostPort": PuertoLocal
                                    }
                                ]
                                }
                            }
                        }),
                        crossDomain: true,

                    }).done(function( data ) {
                            console.log(data);   
                                
                            $("#descripcuerpo").html("SE HA CREADO CORRECTAMENTE EL CONTENEDOR.");
                            $("#pintarred").html("");
                            $("#pintariso").html("");
                            $("#pintarvol").html("");
                            $(".inputcontenedor").val("");
                            $("#descripcioncontenedor").val("");

                    });

                });


                $(function(){

                    $.ajax({                           
                    method:  "POST",
                        dataType: 'json',
                        contentType: "application/json",   
                        url: "http://localhost:2376/networks/"+Red+"/connect", 
                        data: JSON.stringify(
                        {   "Container": Nombre,
                            "EndpointConfig": {
                                "IPAMConfig": {}
                            }

                        }),
                        crossDomain: true,

                    }).done(function( data ) {
                            console.log(data);   
                                
                            $("#descripcuerpo").append("SE HA CREADO CORRECTAMENTE LA RED.");

                    });

                });

            /* } else{

                

            }*/


        });





        // >> - << ------------------------------------------------- >> - << //










        // PINTAR IMÁGENES (ISO) ------------------------------------- //
        $(function() {
                //Llamada Ajax
                $.ajax({
                    method:  "GET",
                    dataType: 'json',   
                    url: "http://localhost:2376/images/json",   
                    crossDomain: true
                }).done(function( data ) {
                        console.log(data);

                        //El elemento principal que se nos devuelve es un vector
                        //por tanto recorremos el vector
                        for (i=0;i<data.length;i++){
                            $("#tableroisos").append(
                                
                                "<input type='radio' name='isos' class='checkbox isospc' value='"+data[i].RepoTags[0]+
                                "'><b> "+data[i].RepoTags[0]+"</b></input><br>"
                                
                                );
                        }

                        $("#tableroisos").append("<p><a href='../ISOS/ISOS.html' class='linkadd'>"+
                        "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Imágenes...</a></p>");

                    }).fail(function( data ){
                    $("#tableroisos").html("<p>No ha sido posible listar las imágenes.</p>"+
                    "<p><a href='../ISOS/ISOS.html' class='linkadd'>"+
                    "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Imágenes...</a></p>");
                });

        });


        // PINTAR REDES ------------------------------------- //
        $(function() {
                //Llamada Ajax
                $.ajax({
                    method:  "GET",
                    dataType: 'json',   
                    url: "http://localhost:2376/networks",   
                    crossDomain: true
                }).done(function( data ) {
                        console.log(data);

                        //El elemento principal que se nos devuelve es un vector
                        //por tanto recorremos el vector
                        for (i=0;i<data.length;i++){
                            $("#tableroredes").append(
                                
                                "<input type='radio' name='redes' class='checkbox redespc' value='"+data[i].Name+"'><b> "+
                                data[i].Name+
                                "</b></input><br>"
                                
                                );
                        }     
                        
                        $("#tableroredes").append("<p><a href='../Redes/Redes.html' class='linkadd'>"+
                        "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Redes...</a></p>");                 
                    }).fail(function( data ){
                    $("#tableroisos").html("<p>No ha sido posible listar las redes.</p>"+
                    "<p><a href='../Redes/Redes.html' class='linkadd'>"+
                    "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Redes...</a></p>");
                });

        });


        // PINTAR VOLÚMENES ------------------------------------- //

        $(function() {

                $.ajax({                           
                method:  "GET",
                    dataType: 'json',   
                    url: "http://localhost:2376/volumes",   
                    crossDomain: true,

                }).done(function( data ) {
                        console.log(data);
                        
                        //El elemento principal que se nos devuelve es un vector
                        //por tanto lo recorro 

                            for (i=0;i<data.Volumes.length;i++){
 
                                elemento = data.Volumes[i];
                                console.log(elemento);

                                var MountPoint = elemento.Mountpoint.slice(elemento.Mountpoint.length-20,);
                                var Nombre = elemento.Name.slice(elemento.Name.length-30,);

                                $("#tablerovolumenes").append(
                                
                                "<input type='radio' name='volumenes' class='checkbox volpc' value='"+Nombre+"'><b> "+Nombre+
                                "</b></input><br>"
                                
                                );
                            }           
                            
                            $("#tablerovolumenes").append("<p><a href='../Volumenes/Volumenes.html' class='linkadd'>"+
                            "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Volúmenes...</a></p>");

                    }).fail(function( data ){
                    $("#tableroisos").html("<p>No ha sido posible listar los volúmenes.</p>"+
                    "<p><a href='../Volumenes/Volumenes.html' class='linkadd'>"+
                    "<img src='../Imagenes/mas.png' class='iconoadd'> Añadir Volúmenes...</a></p>");
                });

        });



    </script>

    <!-- <script>
        $(".red").draggable();
        $("#AddElementos").droppable({
            drop: function(){
                alert("Añadido Correctamente");
            }
        });
    </script> -->
    

</body>
</html>